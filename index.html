<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VGR Konst Sök</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json">
  <link rel="apple-touch-icon" href="./icon-192.png">
  <meta name="theme-color" content="#0077cc" />

  <!-- QR-bibliotek -->
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>

  <style>
    :root{--brand:#0077cc;--brand-dark:#005a9e;--bg:#f7f9fc}
    *{box-sizing:border-box}
    body{font-family:Arial, Helvetica, sans-serif;margin:0;background:var(--bg);color:#222}
    header{padding:18px 16px;text-align:center}
    header h1{margin:0;color:#004a99;font-size:1.25rem}
    .wrap{max-width:1000px;margin:0 auto;padding:0 12px 28px}

    /* Sökfält */
    #searchForm{
      display:grid;grid-template-columns:repeat(4,minmax(170px,1fr));
      gap:10px 12px;background:#fff;padding:12px;border-radius:12px;
      box-shadow:0 8px 24px rgba(0,0,0,.06)
    }
    #searchForm input[type="search"], #searchForm select{
      padding:.7rem .8rem;border:1.5px solid #d0d7de;border-radius:10px;font-size:1rem;background:#fff;
      transition:border-color .2s,box-shadow .2s
    }
    #searchForm input[type="search"]:focus, #searchForm select:focus{
      outline:none;border-color:var(--brand);box-shadow:0 0 0 4px rgba(0,119,204,.12)
    }
    .actions{display:flex;gap:10px;align-items:stretch}
    button{border:none;border-radius:10px;padding:.8rem 1.1rem;font-weight:600;cursor:pointer;
      box-shadow:0 6px 16px rgba(0,0,0,.08)}
    #searchBtn{background:var(--brand);color:#fff}
    #searchBtn:hover{background:var(--brand-dark)}
    #clearBtn{background:#e8eef5;color:#123}
    #clearBtn:hover{background:#dbe7f3}
    #totalCount{margin-top:10px;font-size:.95rem;color:#444}

    .cards{margin-top:14px;display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
    .card{background:#fff;border-radius:14px;padding:14px 14px;
      box-shadow:0 8px 22px rgba(0,0,0,.06);display:flex;flex-direction:column;gap:8px}
    .kv{display:grid;grid-template-columns:110px 1fr;gap:6px 10px;align-items:start}
    .k{color:#5b6b7a;font-size:.9rem}
    .v{font-weight:600}
    .empty{margin-top:16px;color:#566;text-align:center}

    .card .add-btn { align-self:flex-start;padding:6px 10px;border:none;border-radius:8px;cursor:pointer;
      font-weight:600;background:#e8eef5;color:#123 }
    .card.selected .add-btn{background:#d2ebff;color:#004a99}
    .note-line{font-size:.9rem;color:#334;background:#f3f7fc;padding:6px 8px;border-radius:8px}

    .skylt-btn{background:#f0f7ff;color:#034;margin-top:4px}

    /* Urvalspanel */
    .sel-list{margin-top:8px;display:flex;flex-wrap:wrap;gap:6px;max-height:180px;overflow:auto;padding:6px;
      background:#fff;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
    .sel-item{display:inline-flex;align-items:center;gap:6px;padding:4px 6px;border-radius:999px;
      background:#eef4fb;font-weight:600;font-size:.85rem}
    .sel-item button{border:none;background:transparent;cursor:pointer;font-weight:700;font-size:.9rem}
    .sel-item button:hover{opacity:.8}
    #selectionBar button{padding:4px 10px;font-size:.85rem;border-radius:6px;box-shadow:none}

    @media (max-width:900px){#searchForm{grid-template-columns:repeat(2,1fr)}.cards{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:560px){header h1{font-size:1.1rem}#searchForm{grid-template-columns:1fr}
      .actions{flex-direction:column}#searchBtn,#clearBtn{width:100%}.cards{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header><h1>VGR öppna konstdata – sök</h1></header>
  <div class="wrap">
    <form id="searchForm">
      <input type="search" id="creatorInput" placeholder="konstnär" />
      <input type="search" id="titleInput" placeholder="titel" />
      <input type="search" id="createdInput" placeholder="framställningsår" />
      <select id="artformSelect"><option value="">konsttyp (alla)</option></select>
      <select id="artmediumSelect"><option value="">teknik (alla)</option></select>
      <input type="search" id="idInput" placeholder="vg-nummer" />
      <input type="search" id="olderIdInput" placeholder="äldre id" />
      <div class="actions">
        <button id="searchBtn" type="submit">Sök</button>
        <button id="clearBtn" type="button">Rensa</button>
      </div>
    </form>

    <div id="totalCount"></div>
    <div id="selectionBar" style="display:flex;gap:8px;align-items:center;margin-top:8px;">
      <span id="selectionCount">Urval: 0</span>
      <button id="addAllBtn" type="button">Lägg till alla</button>
      <button id="copyMailSelBtn" type="button">Kopiera/Maila urval</button>
      <button id="clearSelBtn" type="button">Rensa urval</button>
    </div>

    <details id="selectionDetails" style="margin-top:6px;">
      <summary>Visa urval</summary>
      <div id="selectionList" class="sel-list"></div>
    </details>

    <div id="cards" class="cards"></div>
    <div id="empty" class="empty" hidden>Inga resultat.</div>
  </div>

<script>
/* --- samma dataloggning som tidigare, nedkortat här --- */

/* ... funktioner för fetchData, renderCards etc ... */

/* ======= Skylt-popup med QR-kod (85x54 mm, Arial, QR nere till höger) ======= */
function openSkylt(entry) {
  const artist = (entry.creator||'').toString();
  const title  = (entry.title||'').toString();
  const year   = (entry.created||'').toString();
  const vg     = (entry.id||'').toString().toUpperCase();

  if(!/^VG\d+$/i.test(vg)){alert('Saknar giltigt VG-nummer.');return;}

  const base = location.origin + location.pathname;
  const url = new URL(base); url.searchParams.set('id', vg);

  let qrDataUrl='';
  try{
    const qrCanvas=document.createElement('canvas');
    new QRious({element:qrCanvas,value:url.toString(),size:120,level:'H'});
    qrDataUrl=qrCanvas.toDataURL('image/png');
  }catch(e){}

  const esc=s=>(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;');

  const html=`<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Skylt ${vg}</title>
<style>
  @page { size: 85mm 54mm; margin: 4mm; }
  body { font-family: Arial, Helvetica, sans-serif; margin:0; }
  .skylt { position:relative; width:100%; height:100%; display:flex; flex-direction:column; justify-content:flex-start; }
  .artist { font-size:14pt; font-weight:bold; }
  .title { font-size:12pt; font-style:italic; }
  .year { font-size:11pt; margin-top:2mm; }
  .meta { font-size:8pt; margin-top:2mm; color:#555; }
  .qr { position:absolute; bottom:0; right:0; width:22mm; height:22mm; }
  @media print { .printbtn{display:none} }
</style>
</head>
<body>
  <div class="skylt">
    <div class="artist">${esc(artist)}</div>
    <div class="title">${esc(title)}</div>
    <div class="year">${esc(year)}</div>
    <div class="meta">VG-nummer: ${esc(vg)}</div>
    ${qrDataUrl?`<img class="qr" src="${qrDataUrl}" alt="QR">`:""}
  </div>
  <button class="printbtn" onclick="print()">Skriv ut</button>
</body>
</html>`;

  const w=window.open('about:blank','_blank');
  w.document.open(); w.document.write(html); w.document.close();
}
</script>
</body>
</html>
